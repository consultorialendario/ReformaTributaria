<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Inteligente de Impostos - Brasil (com Reforma Tribut√°ria)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: #27ae60;
            height: 100%;
            width: 20%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .main-content {
            padding: 30px;
        }

        .wizard-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .step.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            transform: scale(1.05);
        }

        .step.completed {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .step.pending {
            background: #f8f9fa;
            color: #6c757d;
            border: 2px solid #e9ecef;
        }
        
        .section {
            background: #ffffff;
            border: 2px solid #e3e6f0;
            border-radius: 12px;
            margin-bottom: 25px;
            overflow: hidden;
            display: none;
        }

        .section.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            padding: 20px;
            font-weight: bold;
            font-size: 1.3em;
            color: white;
            text-align: center;
        }
        
        .config-header { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .receitas-header { background: linear-gradient(135deg, #27ae60, #229954); }
        .custos-header { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .resultados-header { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .reforma-header { background: linear-gradient(135deg, #8e44ad, #3498db); }
        
        .section-content {
            padding: 25px;
        }
        
        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-field {
            display: flex;
            flex-direction: column;
        }
        
        .input-field label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-field input, .input-field select {
            padding: 12px;
            border: 2px solid #e3e6f0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-field input:focus, .input-field select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .receita-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #27ae60;
        }

        .custo-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #e74c3c;
        }

        .group-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .auto-calc {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .auto-calc .label {
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 5px;
        }

        .auto-calc .value {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .imposto-card {
            background: white;
            border: 2px solid #e3e6f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .imposto-card.devedor {
            border-left: 5px solid #e74c3c;
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.05));
        }

        .imposto-card.credor {
            border-left: 5px solid #27ae60;
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(34, 153, 84, 0.05));
        }

        .imposto-card.neutro {
            border-left: 5px solid #95a5a6;
            background: linear-gradient(135deg, rgba(149, 165, 166, 0.1), rgba(127, 140, 141, 0.05));
        }

        .imposto-card.simples {
            border-left: 5px solid #9b59b6;
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.05));
        }

        .imposto-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .imposto-nome {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .imposto-valor {
            font-size: 1.4em;
            font-weight: bold;
        }

        .imposto-valor.devedor { color: #e74c3c; }
        .imposto-valor.credor { color: #27ae60; }
        .imposto-valor.neutro { color: #95a5a6; }
        .imposto-valor.simples { color: #9b59b6; }

        .calculo-detalhes {
            font-size: 0.9em;
            color: #6c757d;
            line-height: 1.4;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); }
        .btn-success { background: linear-gradient(135deg, #27ae60, #229954); }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .btn-secondary { background: linear-gradient(135deg, #95a5a6, #7f8c8d); }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .summary-total {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }

        .summary-total h3 {
            margin-bottom: 10px;
        }

        .summary-total .valor {
            font-size: 2.2em;
            font-weight: bold;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .comparativo-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .regime-card {
            border: 2px solid #e3e6f0;
            border-radius: 10px;
            padding: 20px;
            background: white;
        }

        .regime-atual {
            border-left: 5px solid #e74c3c;
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.05), rgba(255, 255, 255, 1));
        }

        .regime-novo {
            border-left: 5px solid #27ae60;
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.05), rgba(255, 255, 255, 1));
        }

        .regime-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .regime-atual .regime-title { color: #e74c3c; }
        .regime-novo .regime-title { color: #27ae60; }

        .diferenca-card {
            background: linear-gradient(135deg, #8e44ad, #3498db);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }

        .diferenca-positiva { background: linear-gradient(135deg, #27ae60, #229954); }
        .diferenca-negativa { background: linear-gradient(135deg, #e74c3c, #c0392b); }

        .timeline-transicao {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .timeline-year {
            font-weight: bold;
            color: #3498db;
            margin-right: 15px;
            min-width: 80px;
        }

        .hidden {
            display: none !important;
        }

        .simples-config {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.05));
            border: 2px solid #9b59b6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .composicao-das {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .composicao-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .composicao-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .input-group {
                grid-template-columns: 1fr;
            }

            .wizard-steps {
                flex-direction: column;
                align-items: center;
            }

            .navigation {
                flex-direction: column;
                gap: 10px;
            }

            .comparativo-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Calculadora Inteligente de Impostos</h1>
            <p>Sistema Unificado - Atual vs. Reforma Tribut√°ria (EC 132/2023)</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Wizard Steps -->
            <div class="wizard-steps">
                <div class="step active" id="step1">
                    <span>1Ô∏è‚É£ Configura√ß√£o</span>
                </div>
                <div class="step pending" id="step2">
                    <span>2Ô∏è‚É£ Receitas</span>
                </div>
                <div class="step pending" id="step3">
                    <span>3Ô∏è‚É£ Custos</span>
                </div>
                <div class="step pending" id="step4">
                    <span>4Ô∏è‚É£ Resultados</span>
                </div>
                <div class="step pending" id="step5">
                    <span>üîÑ Reforma</span>
                </div>
            </div>

            <!-- SE√á√ÉO 1: CONFIGURA√á√ÉO -->
            <div class="section active" id="secao1">
                <div class="section-header config-header">
                    ‚öôÔ∏è Configura√ß√£o da Empresa e Regime Tribut√°rio
                </div>
                <div class="section-content">
                    <div class="input-group">
                        <div class="input-field">
                            <label>üìÖ Per√≠odo de Apura√ß√£o:</label>
                            <select id="tipoPeriodo" onchange="atualizarPeriodo()">
                                <option value="mensal">Mensal</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <label>üìÜ <span id="labelPeriodo">M√™s/Ano:</span></label>
                            <input type="month" id="periodo" value="2025-06">
                        </div>
                        <div class="input-field">
                            <label>üè¢ Regime Tribut√°rio:</label>
                            <select id="regime" onchange="atualizarRegime()">
                                <option value="lucro_real">Lucro Real</option>
                                <option value="lucro_presumido">Lucro Presumido</option>
                                <option value="simples">Simples Nacional</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <label>üåç Estado Principal:</label>
                            <select id="estado">
                                <option value="SP">S√£o Paulo</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="PR">Paran√°</option>
                                <option value="SC">Santa Catarina</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <label>üéØ Atividade Principal:</label>
                            <select id="atividade" onchange="atualizarAtividade()">
                                <option value="comercio">Com√©rcio</option>
                                <option value="industria">Ind√∫stria</option>
                                <option value="servicos">Servi√ßos</option>
                                <option value="misto">Atividade Mista</option>
                            </select>
                        </div>
                    </div>

                    <!-- Configura√ß√£o espec√≠fica do Simples Nacional -->
                    <div class="simples-config hidden" id="simplesConfig">
                        <div class="group-title">
                            üìä Configura√ß√£o Simples Nacional
                        </div>
                        <div class="input-group">
                            <div class="input-field">
                                <label>üí∞ Faturamento √öltimos 12 Meses:</label>
                                <input type="number" id="faturamento12Meses" placeholder="0,00" oninput="calcularAutomatico()">
                                <small style="color: #6c757d; margin-top: 5px;">‚ö†Ô∏è Essencial para determinar a faixa de tributa√ß√£o</small>
                            </div>
                        </div>
                    </div>

                    <div id="infoRegime" class="alert alert-info">
                        <strong>üéØ Regime Selecionado:</strong> <span id="regimeInfo">Lucro Real - Permite cr√©ditos de PIS/COFINS n√£o cumulativo</span>
                    </div>
                </div>
            </div>

            <!-- SE√á√ÉO 2: RECEITAS -->
            <div class="section" id="secao2">
                <div class="section-header receitas-header">
                    üí∞ Receitas do Per√≠odo - Base √önica para Todos os Impostos
                </div>
                <div class="section-content">
                    
                    <div class="receita-group">
                        <div class="group-title">
                            üõçÔ∏è Vendas de Produtos (Base ICMS + PIS/COFINS)
                        </div>
                        <div class="input-group">
                            <div class="input-field">
                                <label>üíº Vendas Internas (dentro do estado):</label>
                                <input type="number" id="vendasInternas" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field icms-fields">
                                <label>üìä Al√≠quota ICMS Interna (%):</label>
                                <input type="number" id="aliquotaICMSInterna" value="18" min="7" max="25" step="0.01" placeholder="18%" oninput="validarAliquotaICMS(); calcularAutomatico()">
                                <small style="color: #6c757d; margin-top: 5px;">‚ö†Ô∏è Varia por estado (7% a 25%)</small>
                            </div>
                            <div class="input-field">
                                <label>üì¶ Vendas Interestaduais:</label>
                                <input type="number" id="vendasInterestaduais" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field icms-fields">
                                <label>üìä Al√≠quota ICMS Interestadual (%):</label>
                                <input type="number" id="aliquotaICMSInter" value="12" min="4" max="12" step="0.01" placeholder="12%" oninput="validarAliquotaICMSInter(); calcularAutomatico()">
                                <small style="color: #6c757d; margin-top: 5px;">‚ö†Ô∏è Geralmente 4%, 7% ou 12%</small>
                            </div>
                            <div class="input-field">
                                <label>üåç Exporta√ß√µes (sem impostos):</label>
                                <input type="number" id="exportacoes" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field">
                                <label>üè≠ Vendas Industrializadas (c/ IPI):</label>
                                <input type="number" id="vendasIPI" placeholder="0,00" oninput="calcularAutomatico()">
                                <small style="color: #6c757d; margin-top: 5px;">üí° Apenas produtos industrializados</small>
                            </div>
                            <div class="input-field ipi-fields">
                                <label>üìä Al√≠quota IPI (%):</label>
                                <input type="number" id="aliquotaIPI" value="10" min="0" max="300" step="0.01" placeholder="10%" oninput="calcularAutomatico()">
                                <small style="color: #6c757d; margin-top: 5px;">‚ö†Ô∏è Consulte TIPI (0% a 300%+)</small>
                            </div>
                        </div>
                        
                        <div class="auto-calc">
                            <div class="label">üìä Total Vendas de Produtos:</div>
                            <div class="value" id="totalProdutos">R$ 0,00</div>
                        </div>
                    </div>

                    <div class="receita-group">
                        <div class="group-title">
                            üè¢ Presta√ß√£o de Servi√ßos (Base ISS + PIS/COFINS)
                        </div>
                        <div class="input-group">
                            <div class="input-field">
                                <label>üè™ Servi√ßos no Munic√≠pio:</label>
                                <input type="number" id="servicosMunicipio" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field iss-fields">
                                <label>üìä Al√≠quota ISS do Munic√≠pio (%):</label>
                                <input type="number" id="aliquotaISS" value="5" min="2" max="5" step="0.01" placeholder="5,00%" oninput="validarAliquotaISS(); calcularAutomatico()">
                                <small style="color: #6c757d; margin-top: 5px;">‚ö†Ô∏è Consulte a legisla√ß√£o do seu munic√≠pio (2% a 5%)</small>
                            </div>
                            <div class="input-field">
                                <label>üåê Servi√ßos Outros Munic√≠pios:</label>
                                <input type="number" id="servicosOutros" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field">
                                <label>üåé Servi√ßos no Exterior:</label>
                                <input type="number" id="servicosExterior" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                        </div>
                        
                        <div class="auto-calc">
                            <div class="label">üìä Total Presta√ß√£o de Servi√ßos:</div>
                            <div class="value" id="totalServicos">R$ 0,00</div>
                        </div>
                    </div>

                    <div class="receita-group">
                        <div class="group-title">
                            üí∏ Outras Receitas
                        </div>
                        <div class="input-group">
                            <div class="input-field">
                                <label>üí∞ Receitas Financeiras:</label>
                                <input type="number" id="receitasFinanceiras" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field">
                                <label>üìà Outras Receitas Operacionais:</label>
                                <input type="number" id="outrasReceitas" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                        </div>
                    </div>

                    <div class="summary-total">
                        <h3>üíØ FATURAMENTO TOTAL DO PER√çODO</h3>
                        <div class="valor" id="faturamentoTotal">R$ 0,00</div>
                        <p style="margin-top: 10px; opacity: 0.9;">
                            <span id="basePisCofinslabel">Base autom√°tica para PIS/COFINS</span> = <span id="basePisCofins">R$ 0,00</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- SE√á√ÉO 3: CUSTOS -->
            <div class="section" id="secao3">
                <div class="section-header custos-header">
                    üìã Custos e Despesas - Base √önica para Cr√©ditos
                </div>
                <div class="section-content">
                    
                    <div class="custo-group creditos-fields">
                        <div class="group-title">
                            üîÑ Cr√©ditos de ICMS/IPI/PIS/COFINS
                        </div>
                        <div class="input-group">
                            <div class="input-field">
                                <label>üõí Aquisi√ß√µes de Mercadorias para Revenda:</label>
                                <input type="number" id="aquisicoesRevenda" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field">
                                <label>üè≠ Mat√©rias-primas e Insumos de Produ√ß√£o:</label>
                                <input type="number" id="materiasPrimas" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field">
                                <label>‚ö° Energia El√©trica:</label>
                                <input type="number" id="energiaEletrica" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field">
                                <label>üìû Telecomunica√ß√µes:</label>
                                <input type="number" id="telecomunicacoes" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field">
                                <label>üè† Alugu√©is de Im√≥veis e Equipamentos:</label>
                                <input type="number" id="alugueis" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field">
                                <label>üèóÔ∏è Aquisi√ß√µes de Ativo Imobilizado:</label>
                                <input type="number" id="ativoImobilizado" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                        </div>
                    </div>

                    <div class="custo-group saldos-fields">
                        <div class="group-title">
                            üíæ Saldos Credores de Per√≠odos Anteriores
                        </div>
                        <div class="input-group">
                            <div class="input-field icms-saldo">
                                <label>ICMS Saldo Credor Anterior:</label>
                                <input type="number" id="saldoICMS" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field ipi-saldo">
                                <label>IPI Saldo Credor Anterior:</label>
                                <input type="number" id="saldoIPI" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field pis-saldo">
                                <label>PIS Saldo Credor Anterior:</label>
                                <input type="number" id="saldoPIS" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field cofins-saldo">
                                <label>COFINS Saldo Credor Anterior:</label>
                                <input type="number" id="saldoCOFINS" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                        </div>
                    </div>

                    <div class="custo-group">
                        <div class="group-title">
                            üìë Dedu√ß√µes Espec√≠ficas
                        </div>
                        <div class="input-group">
                            <div class="input-field iss-deducoes">
                                <label>ISS Retido na Fonte:</label>
                                <input type="number" id="issRetido" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                            <div class="input-field iss-deducoes">
                                <label>Dedu√ß√µes Permitidas no ISS:</label>
                                <input type="number" id="deducoesISS" placeholder="0,00" oninput="calcularAutomatico()">
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning simples-aviso hidden">
                        <strong>üí° Simples Nacional:</strong><br>
                        No regime do Simples Nacional, os cr√©ditos de ICMS, IPI, PIS e COFINS n√£o s√£o permitidos.<br>
                        O recolhimento √© feito atrav√©s do DAS (Documento de Arrecada√ß√£o do Simples Nacional) com al√≠quota unificada.
                    </div>
                </div>
            </div>

            <!-- SE√á√ÉO 4: RESULTADOS -->
            <div class="section" id="secao4">
                <div class="section-header resultados-header">
                    üìä Apura√ß√£o Autom√°tica - Sistema Atual
                </div>
                <div class="section-content">
                    
                    <div id="resultadosImpostos">
                        <!-- Os cards dos impostos ser√£o inseridos aqui via JavaScript -->
                    </div>

                    <div class="summary-total">
                        <h3>üí∞ TOTAL GERAL A RECOLHER (Sistema Atual)</h3>
                        <div class="valor" id="totalRecolher">R$ 0,00</div>
                        <p style="margin-top: 10px; opacity: 0.9;">
                            <span id="textoTotalRecolher">Soma de todos os impostos a recolher no per√≠odo</span>
                        </p>
                    </div>

                    <div class="alert alert-success">
                        <strong>‚úÖ Apura√ß√£o Conclu√≠da!</strong> 
                        Todos os c√°lculos foram realizados automaticamente com base nos dados informados.
                        <br><br>
                        <strong>üìã Pr√≥ximos Passos:</strong>
                        <br>‚Ä¢ <span id="proximosPassos">Gerar guias de recolhimento</span>
                        <br>‚Ä¢ Registrar nos livros fiscais
                        <br>‚Ä¢ Efetuar pagamentos at√© dia 20
                    </div>
                </div>
            </div>

            <!-- SE√á√ÉO 5: REFORMA TRIBUT√ÅRIA -->
            <div class="section" id="secao5">
                <div class="section-header reforma-header">
                    üîÑ Comparativo com a Reforma Tribut√°ria (EC 132/2023)
                </div>
                <div class="section-content">
                    
                    <div class="alert alert-info">
                        <strong>üèõÔ∏è Sobre a Reforma Tribut√°ria:</strong><br>
                        A Emenda Constitucional 132/2023 criar√° dois novos impostos unificados:<br>
                        ‚Ä¢ <strong>IBS</strong> (Imposto sobre Bens e Servi√ßos) - substitui ICMS e ISS<br>
                        ‚Ä¢ <strong>CBS</strong> (Contribui√ß√£o sobre Bens e Servi√ßos) - substitui PIS e COFINS<br>
                        ‚Ä¢ <strong>Per√≠odo de transi√ß√£o:</strong> 2026 a 2033 (sistema dual)<br>
                        ‚Ä¢ <strong>Implementa√ß√£o completa:</strong> a partir de 2034
                    </div>

                    <div class="timeline-transicao">
                        <h3 style="margin-bottom: 15px; text-align: center; color: #2c3e50;">üìÖ Cronograma da Transi√ß√£o</h3>
                        <div class="timeline-item">
                            <div class="timeline-year">2025</div>
                            <div>Sistema atual em vigor (√∫ltimo ano)</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2026</div>
                            <div>In√≠cio da cobran√ßa da CBS (50% da al√≠quota) + PIS/COFINS (50%)</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2027</div>
                            <div>CBS (100%) + ICMS/ISS (100%) + In√≠cio do IBS (10%)</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2029</div>
                            <div>CBS (100%) + IBS (60%) + ICMS/ISS (40%)</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2033</div>
                            <div>CBS (100%) + IBS (90%) + ICMS/ISS (10%)</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2034</div>
                            <div>Sistema novo em vigor: CBS (100%) + IBS (100%)</div>
                        </div>
                    </div>

                    <div class="comparativo-container">
                        <div class="regime-card regime-atual">
                            <div class="regime-title">üèõÔ∏è Sistema Atual (2025)</div>
                            <div id="resultadosAtual">
                                <!-- Resultados do sistema atual -->
                            </div>
                        </div>

                        <div class="regime-card regime-novo">
                            <div class="regime-title">üîÑ Reforma Tribut√°ria (2034)</div>
                            <div id="resultadosReforma">
                                <!-- Resultados da reforma -->
                            </div>
                        </div>
                    </div>

                    <div class="diferenca-card" id="diferencaCard">
                        <h3>üí∞ DIFEREN√áA TOTAL</h3>
                        <div class="valor" id="diferencaValor">Calculando...</div>
                        <p style="margin-top: 10px; opacity: 0.9;" id="diferencaTexto">
                            Economia ou acr√©scimo com a reforma
                        </p>
                    </div>

                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è IMPORTANTE - Estimativas:</strong><br>
                        ‚Ä¢ Al√≠quotas da reforma ainda n√£o foram definitivamente regulamentadas<br>
                        ‚Ä¢ Estimativa inicial: IBS + CBS = 26,5% (pode variar entre 24% e 28%)<br>
                        ‚Ä¢ Podem haver al√≠quotas diferenciadas por setor<br>
                        ‚Ä¢ Cesta b√°sica e alguns servi√ßos essenciais podem ter al√≠quota zero<br>
                        ‚Ä¢ Sistema de cr√©ditos ser√° mantido e aprimorado<br><br>
                        
                        <strong>üìä Principais Mudan√ßas:</strong><br>
                        ‚Ä¢ Unifica√ß√£o de ICMS + ISS = IBS<br>
                        ‚Ä¢ Unifica√ß√£o de PIS + COFINS = CBS<br>
                        ‚Ä¢ Fim da "guerra fiscal" entre estados<br>
                        ‚Ä¢ Simplifica√ß√£o das obriga√ß√µes acess√≥rias<br>
                        ‚Ä¢ Tributa√ß√£o no destino (n√£o mais na origem)<br>
                        ‚Ä¢ Regime unificado para o pa√≠s todo
                    </div>

                    <div class="input-group" style="margin-top: 20px;">
                        <div class="input-field">
                            <label>üéØ Al√≠quota IBS + CBS Estimada (%):</label>
                            <input type="number" id="aliquotaReforma" value="26.5" min="20" max="35" step="0.1" placeholder="26,5%" oninput="calcularReforma()">
                            <small style="color: #6c757d; margin-top: 5px;">üí° Estimativa inicial: 26,5% (pode variar entre 24% e 28%)</small>
                        </div>
                        <div class="input-field">
                            <label>üìÖ Ano de An√°lise da Transi√ß√£o:</label>
                            <select id="anoTransicao" onchange="calcularReforma()">
                                <option value="2025">2025 - Sistema Atual (100%)</option>
                                <option value="2026">2026 - In√≠cio da CBS (50%/50%)</option>
                                <option value="2027">2027 - CBS Total + IBS 10%</option>
                                <option value="2029">2029 - Meio da Transi√ß√£o</option>
                                <option value="2033">2033 - Quase Completa</option>
                                <option value="2034" selected>2034 - Reforma Completa (100%)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="btn btn-secondary" id="btnAnterior" onclick="voltarEtapa()" disabled>
                    ‚¨ÖÔ∏è Anterior
                </button>
                
                <div style="text-align: center;">
                    <button class="btn btn-warning" onclick="limparTudo()">üóëÔ∏è Limpar Tudo</button>
                    <button class="btn btn-success" onclick="gerarRelatorio()">üìä Gerar Relat√≥rio</button>
                </div>
                
                <button class="btn btn-primary" id="btnProximo" onclick="proximaEtapa()">
                    Pr√≥ximo ‚û°Ô∏è
                </button>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let etapaAtual = 1;
        const totalEtapas = 5;
        let resultadosAtualCalculados = [];
        let totalAtual = 0;

        // Al√≠quotas fixas (apenas PIS/COFINS que s√£o federais)
        const aliquotas = {
            pis: {
                nao_cumulativo: 1.65,
                cumulativo: 0.65
            },
            cofins: {
                nao_cumulativo: 7.6,
                cumulativo: 3.0
            }
        };

        // Tabelas do Simples Nacional (2024/2025)
        const tabelasSimples = {
            anexo1: [ // Com√©rcio
                {min: 0, max: 180000, aliquota: 4.0},
                {min: 180000.01, max: 360000, aliquota: 7.3},
                {min: 360000.01, max: 720000, aliquota: 9.5},
                {min: 720000.01, max: 1800000, aliquota: 10.7},
                {min: 1800000.01, max: 3600000, aliquota: 14.3},
                {min: 3600000.01, max: 4800000, aliquota: 19.0}
            ],
            anexo2: [ // Ind√∫stria
                {min: 0, max: 180000, aliquota: 4.5},
                {min: 180000.01, max: 360000, aliquota: 7.8},
                {min: 360000.01, max: 720000, aliquota: 10.0},
                {min: 720000.01, max: 1800000, aliquota: 11.2},
                {min: 1800000.01, max: 3600000, aliquota: 14.7},
                {min: 3600000.01, max: 4800000, aliquota: 30.0}
            ],
            anexo3: [ // Servi√ßos
                {min: 0, max: 180000, aliquota: 6.0},
                {min: 180000.01, max: 360000, aliquota: 11.2},
                {min: 360000.01, max: 720000, aliquota: 13.5},
                {min: 720000.01, max: 1800000, aliquota: 16.0},
                {min: 1800000.01, max: 3600000, aliquota: 21.0},
                {min: 3600000.01, max: 4800000, aliquota: 33.0}
            ]
        };

        function atualizarPeriodo() {
            const tipoPeriodo = document.getElementById('tipoPeriodo').value;
            const labelPeriodo = document.getElementById('labelPeriodo');
            const inputPeriodo = document.getElementById('periodo');
            
            if (tipoPeriodo === 'anual') {
                labelPeriodo.textContent = 'Ano:';
                inputPeriodo.type = 'number';
                inputPeriodo.value = '2025';
                inputPeriodo.min = '2020';
                inputPeriodo.max = '2030';
            } else {
                labelPeriodo.textContent = 'M√™s/Ano:';
                inputPeriodo.type = 'month';
                inputPeriodo.value = '2025-06';
                inputPeriodo.removeAttribute('min');
                inputPeriodo.removeAttribute('max');
            }
            calcularAutomatico();
        }

        function validarAliquotaISS() {
            const aliquotaInput = document.getElementById('aliquotaISS');
            const valor = parseFloat(aliquotaInput.value);
            
            if (valor < 2) {
                aliquotaInput.value = 2;
                alert('‚ö†Ô∏è Al√≠quota m√≠nima do ISS √© 2,00%');
            } else if (valor > 5) {
                aliquotaInput.value = 5;
                alert('‚ö†Ô∏è Al√≠quota m√°xima do ISS √© 5,00%');
            }
        }

        function validarAliquotaICMS() {
            const aliquotaInput = document.getElementById('aliquotaICMSInterna');
            const valor = parseFloat(aliquotaInput.value);
            
            if (valor < 7) {
                aliquotaInput.value = 7;
                alert('‚ö†Ô∏è Al√≠quota m√≠nima do ICMS interno √© 7,00%');
            } else if (valor > 25) {
                aliquotaInput.value = 25;
                alert('‚ö†Ô∏è Al√≠quota m√°xima do ICMS interno √© 25,00%');
            }
        }

        function validarAliquotaICMSInter() {
            const aliquotaInput = document.getElementById('aliquotaICMSInter');
            const valor = parseFloat(aliquotaInput.value);
            
            if (valor < 4) {
                aliquotaInput.value = 4;
                alert('‚ö†Ô∏è Al√≠quota m√≠nima do ICMS interestadual √© 4,00%');
            } else if (valor > 12) {
                aliquotaInput.value = 12;
                alert('‚ö†Ô∏è Al√≠quota m√°xima do ICMS interestadual √© 12,00%');
            }
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor || 0);
        }

        function obterAliquotaSimples(faturamento12Meses, anexo) {
            const tabela = tabelasSimples[anexo];
            if (!tabela) return 0;
            
            for (let faixa of tabela) {
                if (faturamento12Meses >= faixa.min && faturamento12Meses <= faixa.max) {
                    return faixa.aliquota;
                }
            }
            return 0; // Acima do limite do Simples
        }

        function atualizarRegime() {
            const regime = document.getElementById('regime').value;
            const infoElement = document.getElementById('regimeInfo');
            
            // Mostrar/ocultar campos conforme regime
            const simplesConfig = document.getElementById('simplesConfig');
            const creditosFields = document.querySelectorAll('.creditos-fields');
            const saldosFields = document.querySelectorAll('.saldos-fields');
            const simplesAviso = document.querySelector('.simples-aviso');
            const icmsFields = document.querySelectorAll('.icms-fields');
            const ipiFields = document.querySelectorAll('.ipi-fields');
            const issFields = document.querySelectorAll('.iss-fields');
            const pisSaldo = document.querySelectorAll('.pis-saldo');
            const cofinsSaldo = document.querySelectorAll('.cofins-saldo');
            
            let info = '';
            switch(regime) {
                case 'lucro_real':
                    info = 'Lucro Real - Permite cr√©ditos de PIS/COFINS n√£o cumulativo (1,65% e 7,6%)';
                    simplesConfig.classList.add('hidden');
                    creditosFields.forEach(el => el.classList.remove('hidden'));
                    saldosFields.forEach(el => el.classList.remove('hidden'));
                    simplesAviso.classList.add('hidden');
                    icmsFields.forEach(el => el.classList.remove('hidden'));
                    ipiFields.forEach(el => el.classList.remove('hidden'));
                    issFields.forEach(el => el.classList.remove('hidden'));
                    pisSaldo.forEach(el => el.classList.remove('hidden'));
                    cofinsSaldo.forEach(el => el.classList.remove('hidden'));
                    break;
                case 'lucro_presumido':
                    info = 'Lucro Presumido - PIS/COFINS cumulativo (0,65% e 3,0%), sem direito a cr√©ditos PIS/COFINS';
                    simplesConfig.classList.add('hidden');
                    creditosFields.forEach(el => el.classList.remove('hidden'));
                    saldosFields.forEach(el => el.classList.remove('hidden'));
                    simplesAviso.classList.add('hidden');
                    icmsFields.forEach(el => el.classList.remove('hidden'));
                    ipiFields.forEach(el => el.classList.remove('hidden'));
                    issFields.forEach(el => el.classList.remove('hidden'));
                    pisSaldo.forEach(el => el.classList.add('hidden'));
                    cofinsSaldo.forEach(el => el.classList.add('hidden'));
                    break;
                case 'simples':
                    info = 'Simples Nacional - DAS unificado com al√≠quotas baseadas no faturamento dos √∫ltimos 12 meses';
                    simplesConfig.classList.remove('hidden');
                    creditosFields.forEach(el => el.classList.add('hidden'));
                    saldosFields.forEach(el => el.classList.add('hidden'));
                    simplesAviso.classList.remove('hidden');
                    icmsFields.forEach(el => el.classList.add('hidden'));
                    ipiFields.forEach(el => el.classList.add('hidden'));
                    issFields.forEach(el => el.classList.add('hidden'));
                    break;
            }
            
            infoElement.innerHTML = `<strong>üéØ Regime Selecionado:</strong> ${info}`;
            
            // Atualizar labels conforme regime
            const basePisCofinslabel = document.getElementById('basePisCofinslabel');
            if (regime === 'simples') {
                basePisCofinslabel.textContent = 'Base para DAS do Simples Nacional';
            } else {
                basePisCofinslabel.textContent = 'Base autom√°tica para PIS/COFINS';
            }
            
            calcularAutomatico();
        }

        function atualizarAtividade() {
            calcularAutomatico();
        }

        function calcularAutomatico() {
            // Coletar valores das receitas
            const vendasInternas = parseFloat(document.getElementById('vendasInternas')?.value) || 0;
            const vendasInterestaduais = parseFloat(document.getElementById('vendasInterestaduais')?.value) || 0;
            const exportacoes = parseFloat(document.getElementById('exportacoes')?.value) || 0;
            const vendasIPI = parseFloat(document.getElementById('vendasIPI')?.value) || 0;
            const servicosMunicipio = parseFloat(document.getElementById('servicosMunicipio')?.value) || 0;
            const servicosOutros = parseFloat(document.getElementById('servicosOutros')?.value) || 0;
            const servicosExterior = parseFloat(document.getElementById('servicosExterior')?.value) || 0;
            const receitasFinanceiras = parseFloat(document.getElementById('receitasFinanceiras')?.value) || 0;
            const outrasReceitas = parseFloat(document.getElementById('outrasReceitas')?.value) || 0;

            // Calcular totais
            const totalProdutos = vendasInternas + vendasInterestaduais + exportacoes + vendasIPI;
            const totalServicos = servicosMunicipio + servicosOutros + servicosExterior;
            const faturamentoTotal = totalProdutos + totalServicos + receitasFinanceiras + outrasReceitas;
            const basePisCofins = totalProdutos + totalServicos; // Excluindo receitas financeiras

            // Atualizar displays
            if (document.getElementById('totalProdutos')) {
                document.getElementById('totalProdutos').textContent = formatarMoeda(totalProdutos);
            }
            if (document.getElementById('totalServicos')) {
                document.getElementById('totalServicos').textContent = formatarMoeda(totalServicos);
            }
            if (document.getElementById('faturamentoTotal')) {
                document.getElementById('faturamentoTotal').textContent = formatarMoeda(faturamentoTotal);
            }
            if (document.getElementById('basePisCofins')) {
                document.getElementById('basePisCofins').textContent = formatarMoeda(basePisCofins);
            }

            // Calcular impostos se estivermos na √∫ltima etapa
            if (etapaAtual === 4) {
                calcularTodosImpostos();
            } else if (etapaAtual === 5) {
                calcularTodosImpostos();
                calcularReforma();
            }
        }

        function calcularTodosImpostos() {
            const regime = document.getElementById('regime').value;
            
            if (regime === 'simples') {
                calcularSimplesNacional();
            } else {
                calcularRegimeTradicional();
            }
        }

        function calcularSimplesNacional() {
            const atividade = document.getElementById('atividade').value;
            const faturamento12Meses = parseFloat(document.getElementById('faturamento12Meses')?.value) || 0;
            
            const vendasInternas = parseFloat(document.getElementById('vendasInternas')?.value) || 0;
            const vendasInterestaduais = parseFloat(document.getElementById('vendasInterestaduais')?.value) || 0;
            const vendasIPI = parseFloat(document.getElementById('vendasIPI')?.value) || 0;
            const servicosMunicipio = parseFloat(document.getElementById('servicosMunicipio')?.value) || 0;
            const servicosOutros = parseFloat(document.getElementById('servicosOutros')?.value) || 0;
            
            const totalComercio = vendasInternas + vendasInterestaduais;
            const totalIndustria = vendasIPI;
            const totalServicos = servicosMunicipio + servicosOutros;
            const faturamentoPeriodo = totalComercio + totalIndustria + totalServicos;
            
            let resultados = [];
            let dasTotal = 0;
            let composicaoDetalhada = '';
            
            if (faturamento12Meses === 0) {
                resultados.push({
                    nome: 'Aviso',
                    valor: 0,
                    detalhes: 'Informe o faturamento dos √∫ltimos 12 meses para calcular o DAS'
                });
            } else {
                // Para empresa mista, calcular cada atividade separadamente
                if (atividade === 'misto') {
                    let composicao = [];
                    
                    if (totalComercio > 0) {
                        const aliquotaComercio = obterAliquotaSimples(faturamento12Meses, 'anexo1');
                        const dasComercio = totalComercio * (aliquotaComercio / 100);
                        dasTotal += dasComercio;
                        composicao.push(`Com√©rcio: ${formatarMoeda(dasComercio)} (${aliquotaComercio}%)`);
                    }
                    
                    if (totalIndustria > 0) {
                        const aliquotaIndustria = obterAliquotaSimples(faturamento12Meses, 'anexo2');
                        const dasIndustria = totalIndustria * (aliquotaIndustria / 100);
                        dasTotal += dasIndustria;
                        composicao.push(`Ind√∫stria: ${formatarMoeda(dasIndustria)} (${aliquotaIndustria}%)`);
                    }
                    
                    if (totalServicos > 0) {
                        const aliquotaServicos = obterAliquotaSimples(faturamento12Meses, 'anexo3');
                        const dasServicos = totalServicos * (aliquotaServicos / 100);
                        dasTotal += dasServicos;
                        composicao.push(`Servi√ßos: ${formatarMoeda(dasServicos)} (${aliquotaServicos}%)`);
                    }
                    
                    composicaoDetalhada = composicao.join(' | ');
                } else {
                    // Atividade √∫nica
                    let anexo = '';
                    switch(atividade) {
                        case 'comercio': anexo = 'anexo1'; break;
                        case 'industria': anexo = 'anexo2'; break;
                        case 'servicos': anexo = 'anexo3'; break;
                    }
                    
                    const aliquota = obterAliquotaSimples(faturamento12Meses, anexo);
                    dasTotal = faturamentoPeriodo * (aliquota / 100);
                    composicaoDetalhada = `Al√≠quota: ${aliquota}% | Base: ${formatarMoeda(faturamentoPeriodo)}`;
                }
                
                resultados.push({
                    nome: 'DAS - Simples Nacional',
                    valor: dasTotal,
                    detalhes: `Faturamento 12 meses: ${formatarMoeda(faturamento12Meses)} | ${composicaoDetalhada}`,
                    simples: true
                });
            }
            
            resultadosAtualCalculados = resultados;
            exibirResultadosSimples(resultados);
        }

        function calcularRegimeTradicional() {
            const regime = document.getElementById('regime').value;
            
            // Coletar dados das receitas
            const vendasInternas = parseFloat(document.getElementById('vendasInternas')?.value) || 0;
            const vendasInterestaduais = parseFloat(document.getElementById('vendasInterestaduais')?.value) || 0;
            const vendasIPI = parseFloat(document.getElementById('vendasIPI')?.value) || 0;
            const servicosMunicipio = parseFloat(document.getElementById('servicosMunicipio')?.value) || 0;
            const servicosOutros = parseFloat(document.getElementById('servicosOutros')?.value) || 0;
            
            // Base para PIS/COFINS (todos os servi√ßos + produtos, exceto financeiras)
            const basePisCofins = vendasInternas + vendasInterestaduais + vendasIPI + servicosMunicipio + servicosOutros;
            
            // Coletar dados dos custos
            const aquisicoesRevenda = parseFloat(document.getElementById('aquisicoesRevenda')?.value) || 0;
            const materiasPrimas = parseFloat(document.getElementById('materiasPrimas')?.value) || 0;
            const energiaEletrica = parseFloat(document.getElementById('energiaEletrica')?.value) || 0;
            const telecomunicacoes = parseFloat(document.getElementById('telecomunicacoes')?.value) || 0;
            const alugueis = parseFloat(document.getElementById('alugueis')?.value) || 0;
            const ativoImobilizado = parseFloat(document.getElementById('ativoImobilizado')?.value) || 0;
            
            const saldoICMS = parseFloat(document.getElementById('saldoICMS')?.value) || 0;
            const saldoIPI = parseFloat(document.getElementById('saldoIPI')?.value) || 0;
            const saldoPIS = parseFloat(document.getElementById('saldoPIS')?.value) || 0;
            const saldoCOFINS = parseFloat(document.getElementById('saldoCOFINS')?.value) || 0;
            
            const issRetido = parseFloat(document.getElementById('issRetido')?.value) || 0;
            const deducoesISS = parseFloat(document.getElementById('deducoesISS')?.value) || 0;

            let resultados = [];

            // ICMS
            if (vendasInternas > 0 || vendasInterestaduais > 0) {
                const aliquotaInterna = parseFloat(document.getElementById('aliquotaICMSInterna')?.value) || 18;
                const aliquotaInter = parseFloat(document.getElementById('aliquotaICMSInter')?.value) || 12;
                
                const icmsInternas = vendasInternas * (aliquotaInterna / 100);
                const icmsInterestaduais = vendasInterestaduais * (aliquotaInter / 100);
                const icmsDebito = icmsInternas + icmsInterestaduais;
                
                const icmsCredito = (aquisicoesRevenda + materiasPrimas + energiaEletrica + telecomunicacoes + ativoImobilizado) * 0.18 + saldoICMS;
                const icmsAPagar = icmsDebito - icmsCredito;
                
                resultados.push({
                    nome: 'ICMS',
                    valor: icmsAPagar,
                    detalhes: `D√©bito: ${formatarMoeda(icmsDebito)} (Interna: ${aliquotaInterna}%, Inter: ${aliquotaInter}%) | Cr√©dito: ${formatarMoeda(icmsCredito)}`
                });
            }

            // IPI
            if (vendasIPI > 0) {
                const aliquotaIPI = parseFloat(document.getElementById('aliquotaIPI')?.value) || 10;
                const ipiDebito = vendasIPI * (aliquotaIPI / 100);
                
                const ipiCredito = (materiasPrimas * (aliquotaIPI / 100) * 0.5) + saldoIPI;
                const ipiAPagar = ipiDebito - ipiCredito;
                
                resultados.push({
                    nome: 'IPI',
                    valor: ipiAPagar,
                    detalhes: `Base: ${formatarMoeda(vendasIPI)} | Al√≠quota: ${aliquotaIPI}% | Cr√©dito Total: ${formatarMoeda(ipiCredito)}`
                });
            }

            // ISS
            if (servicosMunicipio > 0 || servicosOutros > 0) {
                const aliquotaISS = parseFloat(document.getElementById('aliquotaISS')?.value) || 5;
                const baseISS = (servicosMunicipio + servicosOutros) - deducoesISS;
                const issDevido = baseISS * (aliquotaISS / 100);
                const issAPagar = Math.max(0, issDevido - issRetido);
                
                resultados.push({
                    nome: 'ISS',
                    valor: issAPagar,
                    detalhes: `Base: ${formatarMoeda(baseISS)} | Al√≠quota: ${aliquotaISS}% | Retido: ${formatarMoeda(issRetido)}`
                });
            }

            // PIS
            if (basePisCofins > 0) {
                const aliqPIS = regime === 'lucro_real' ? aliquotas.pis.nao_cumulativo : aliquotas.pis.cumulativo;
                const pisDebito = basePisCofins * (aliqPIS / 100);
                
                let pisCredito = regime === 'lucro_real' ? saldoPIS : 0;
                if (regime === 'lucro_real') {
                    pisCredito += (aquisicoesRevenda + materiasPrimas + energiaEletrica + alugueis + ativoImobilizado) * 0.0165;
                }
                
                const pisAPagar = pisDebito - pisCredito;
                
                resultados.push({
                    nome: 'PIS',
                    valor: pisAPagar,
                    detalhes: `Base: ${formatarMoeda(basePisCofins)} | Al√≠quota: ${aliqPIS}% | Cr√©dito: ${formatarMoeda(pisCredito)}`
                });
            }

            // COFINS
            if (basePisCofins > 0) {
                const aliqCOFINS = regime === 'lucro_real' ? aliquotas.cofins.nao_cumulativo : aliquotas.cofins.cumulativo;
                const cofinsDebito = basePisCofins * (aliqCOFINS / 100);
                
                let cofinsCredito = regime === 'lucro_real' ? saldoCOFINS : 0;
                if (regime === 'lucro_real') {
                    cofinsCredito += (aquisicoesRevenda + materiasPrimas + energiaEletrica + alugueis + ativoImobilizado) * 0.076;
                }
                
                const cofinsAPagar = cofinsDebito - cofinsCredito;
                
                resultados.push({
                    nome: 'COFINS',
                    valor: cofinsAPagar,
                    detalhes: `Base: ${formatarMoeda(basePisCofins)} | Al√≠quota: ${aliqCOFINS}% | Cr√©dito: ${formatarMoeda(cofinsCredito)}`
                });
            }

            resultadosAtualCalculados = resultados;
            exibirResultados(resultados);
        }

        function exibirResultados(resultados) {
            const container = document.getElementById('resultadosImpostos');
            let html = '';
            totalAtual = 0;

            resultados.forEach(resultado => {
                let classe, status, icon;
                
                if (resultado.valor > 0) {
                    classe = 'devedor';
                    status = 'devedor';
                    icon = 'üì§';
                    totalAtual += resultado.valor;
                } else if (resultado.valor < 0) {
                    classe = 'credor';
                    status = 'credor';
                    icon = 'üì•';
                } else {
                    classe = 'neutro';
                    status = 'neutro';
                    icon = '‚öñÔ∏è';
                }

                const valorDisplay = Math.abs(resultado.valor);
                const statusText = resultado.valor > 0 ? 'A Recolher' : resultado.valor < 0 ? 'Saldo Credor' : 'Sem Movimento';

                html += `
                    <div class="imposto-card ${classe}">
                        <div class="imposto-header">
                            <div class="imposto-nome">${icon} ${resultado.nome} - ${statusText}</div>
                            <div class="imposto-valor ${status}">${formatarMoeda(valorDisplay)}</div>
                        </div>
                        <div class="calculo-detalhes">${resultado.detalhes}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
            document.getElementById('totalRecolher').textContent = formatarMoeda(totalAtual);
        }

        function exibirResultadosSimples(resultados) {
            const container = document.getElementById('resultadosImpostos');
            let html = '';
            totalAtual = 0;

            resultados.forEach(resultado => {
                if (resultado.simples) {
                    totalAtual += resultado.valor;
                    
                    html += `
                        <div class="imposto-card simples">
                            <div class="imposto-header">
                                <div class="imposto-nome">üìã ${resultado.nome}</div>
                                <div class="imposto-valor simples">${formatarMoeda(resultado.valor)}</div>
                            </div>
                            <div class="calculo-detalhes">${resultado.detalhes}</div>
                            <div class="composicao-das">
                                <strong>üìä Composi√ß√£o do DAS:</strong><br>
                                <small>IRPJ, CSLL, PIS, COFINS, IPI, ICMS, ISS e CPP unificados</small>
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="imposto-card neutro">
                            <div class="imposto-header">
                                <div class="imposto-nome">‚ö†Ô∏è ${resultado.nome}</div>
                                <div class="imposto-valor neutro">-</div>
                            </div>
                            <div class="calculo-detalhes">${resultado.detalhes}</div>
                        </div>
                    `;
                }
            });

            container.innerHTML = html;
            document.getElementById('totalRecolher').textContent = formatarMoeda(totalAtual);
            
            // Atualizar textos espec√≠ficos do Simples
            const textoTotalRecolher = document.getElementById('textoTotalRecolher');
            const proximosPassos = document.getElementById('proximosPassos');
            
            if (document.getElementById('regime').value === 'simples') {
                textoTotalRecolher.textContent = 'Valor total do DAS a recolher no per√≠odo';
                proximosPassos.textContent = 'Gerar DAS via Portal do Simples Nacional';
            } else {
                textoTotalRecolher.textContent = 'Soma de todos os impostos a recolher no per√≠odo';
                proximosPassos.textContent = 'Gerar guias de recolhimento';
            }
        }

        function calcularReforma() {
            // Para o Simples Nacional, a reforma manter√° um regime simplificado
            const regime = document.getElementById('regime').value;
            
            if (regime === 'simples') {
                calcularReformaSimples();
            } else {
                calcularReformaTradicional();
            }
        }

        function calcularReformaSimples() {
            // No Simples Nacional da reforma, mant√©m-se um regime simplificado
            // mas com al√≠quotas potencialmente diferentes
            const vendasInternas = parseFloat(document.getElementById('vendasInternas')?.value) || 0;
            const vendasInterestaduais = parseFloat(document.getElementById('vendasInterestaduais')?.value) || 0;
            const vendasIPI = parseFloat(document.getElementById('vendasIPI')?.value) || 0;
            const servicosMunicipio = parseFloat(document.getElementById('servicosMunicipio')?.value) || 0;
            const servicosOutros = parseFloat(document.getElementById('servicosOutros')?.value) || 0;
            
            const baseReforma = vendasInternas + vendasInterestaduais + vendasIPI + servicosMunicipio + servicosOutros;
            const faturamento12Meses = parseFloat(document.getElementById('faturamento12Meses')?.value) || 0;
            
            // Estimativa: Simples Nacional na reforma pode ter redu√ß√£o de ~10-15%
            const fatorReducao = 0.9; // 10% de redu√ß√£o estimada
            const dasAtual = totalAtual;
            const dasReforma = dasAtual * fatorReducao;
            
            exibirResultadosReformaSimples(dasReforma);
            exibirDiferenca(dasReforma - totalAtual);
        }

        function calcularReformaTradicional() {
            // Dados b√°sicos
            const vendasInternas = parseFloat(document.getElementById('vendasInternas')?.value) || 0;
            const vendasInterestaduais = parseFloat(document.getElementById('vendasInterestaduais')?.value) || 0;
            const vendasIPI = parseFloat(document.getElementById('vendasIPI')?.value) || 0;
            const servicosMunicipio = parseFloat(document.getElementById('servicosMunicipio')?.value) || 0;
            const servicosOutros = parseFloat(document.getElementById('servicosOutros')?.value) || 0;
            
            const baseReforma = vendasInternas + vendasInterestaduais + vendasIPI + servicosMunicipio + servicosOutros;
            
            // Cr√©ditos
            const aquisicoesRevenda = parseFloat(document.getElementById('aquisicoesRevenda')?.value) || 0;
            const materiasPrimas = parseFloat(document.getElementById('materiasPrimas')?.value) || 0;
            const energiaEletrica = parseFloat(document.getElementById('energiaEletrica')?.value) || 0;
            const telecomunicacoes = parseFloat(document.getElementById('telecomunicacoes')?.value) || 0;
            const alugueis = parseFloat(document.getElementById('alugueis')?.value) || 0;
            const ativoImobilizado = parseFloat(document.getElementById('ativoImobilizado')?.value) || 0;
            
            const aliquotaReforma = parseFloat(document.getElementById('aliquotaReforma')?.value) || 26.5;
            const anoTransicao = document.getElementById('anoTransicao')?.value || '2034';
            
            // C√°lculo da al√≠quota efetiva baseada no ano de transi√ß√£o
            let percentualNovo = 1;
            
            switch(anoTransicao) {
                case '2025': percentualNovo = 0; break;
                case '2026': percentualNovo = 0.5; break;
                case '2027': percentualNovo = 0.6; break;
                case '2029': percentualNovo = 0.8; break;
                case '2033': percentualNovo = 0.95; break;
                case '2034': default: percentualNovo = 1; break;
            }
            
            // Na reforma, teremos IBS + CBS unificados
            const debito = baseReforma * (aliquotaReforma / 100) * percentualNovo;
            
            // Cr√©ditos da reforma (mant√©m o mesmo princ√≠pio)
            const creditos = (aquisicoesRevenda + materiasPrimas + energiaEletrica + telecomunicacoes + alugueis + ativoImobilizado) * (aliquotaReforma / 100) * percentualNovo;
            
            const impostoReforma = debito - creditos;
            
            // IPI residual (apenas para produtos espec√≠ficos na reforma)
            let ipiResidual = 0;
            if (vendasIPI > 0) {
                const aliquotaIPI = parseFloat(document.getElementById('aliquotaIPI')?.value) || 10;
                ipiResidual = (vendasIPI * (aliquotaIPI / 100) * 0.1) * percentualNovo;
            }
            
            const totalReforma = impostoReforma + ipiResidual;
            
            // Se estamos na transi√ß√£o, adicionar parte do sistema antigo
            let totalSistemaAntigo = 0;
            if (percentualNovo < 1) {
                totalSistemaAntigo = totalAtual * (1 - percentualNovo);
            }
            
            const totalFinalReforma = totalReforma + totalSistemaAntigo;
            
            exibirResultadosReforma(impostoReforma, ipiResidual, totalFinalReforma, anoTransicao, percentualNovo);
            exibirDiferenca(totalFinalReforma - totalAtual);
        }

        function exibirResultadosReformaSimples(dasReforma) {
            const container = document.getElementById('resultadosReforma');
            
            let html = `
                <div class="imposto-card simples">
                    <div class="imposto-header">
                        <div class="imposto-nome">üìã DAS Simplificado (Reforma)</div>
                        <div class="imposto-valor simples">${formatarMoeda(dasReforma)}</div>
                    </div>
                    <div class="calculo-detalhes">Sistema unificado simplificado mantido na reforma</div>
                </div>
                
                <div class="summary-total" style="margin-top: 20px;">
                    <h3>üí∞ TOTAL REFORMA</h3>
                    <div class="valor">${formatarMoeda(dasReforma)}</div>
                    <p style="margin-top: 10px; opacity: 0.9;">
                        Simples Nacional reformulado
                    </p>
                </div>
            `;
            
            container.innerHTML = html;
            exibirResumoAtual();
        }

        function exibirResultadosReforma(impostoUnificado, ipiResidual, totalReforma, ano, percentual) {
            const container = document.getElementById('resultadosReforma');
            let html = '';
            
            // Card do imposto unificado
            let classe = impostoUnificado > 0 ? 'devedor' : impostoUnificado < 0 ? 'credor' : 'neutro';
            let status = impostoUnificado > 0 ? 'devedor' : impostoUnificado < 0 ? 'credor' : 'neutro';
            let icon = impostoUnificado > 0 ? 'üì§' : impostoUnificado < 0 ? 'üì•' : '‚öñÔ∏è';
            let nomeImposto = ano === '2034' ? 'IBS + CBS' : `Sistema Misto (${Math.round(percentual * 100)}% Novo)`;
            
            html += `
                <div class="imposto-card ${classe}">
                    <div class="imposto-header">
                        <div class="imposto-nome">${icon} ${nomeImposto}</div>
                        <div class="imposto-valor ${status}">${formatarMoeda(Math.abs(impostoUnificado))}</div>
                    </div>
                    <div class="calculo-detalhes">Imposto unificado sobre bens e servi√ßos - ${formatarMoeda(impostoUnificado)}</div>
                </div>
            `;
            
            // IPI residual se houver
            if (ipiResidual > 0) {
                html += `
                    <div class="imposto-card devedor">
                        <div class="imposto-header">
                            <div class="imposto-nome">üè≠ IPI Residual</div>
                            <div class="imposto-valor devedor">${formatarMoeda(ipiResidual)}</div>
                        </div>
                        <div class="calculo-detalhes">IPI com escopo reduzido (produtos espec√≠ficos)</div>
                    </div>
                `;
            }
            
            html += `
                <div class="summary-total" style="margin-top: 20px;">
                    <h3>üí∞ TOTAL REFORMA (${ano})</h3>
                    <div class="valor">${formatarMoeda(totalReforma)}</div>
                    <p style="margin-top: 10px; opacity: 0.9;">
                        Carga tribut√°ria unificada
                    </p>
                </div>
            `;
            
            container.innerHTML = html;
            exibirResumoAtual();
        }

        function exibirResumoAtual() {
            const container = document.getElementById('resultadosAtual');
            const regime = document.getElementById('regime').value;
            let html = '';
            
            if (regime === 'simples') {
                html = `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                        <span>DAS Simples Nacional</span>
                        <span style="font-weight: bold;">${formatarMoeda(totalAtual)}</span>
                    </div>
                `;
            } else {
                resultadosAtualCalculados.forEach(resultado => {
                    if (resultado.valor > 0) {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                                <span>${resultado.nome}</span>
                                <span style="font-weight: bold;">${formatarMoeda(resultado.valor)}</span>
                            </div>
                        `;
                    }
                });
            }
            
            html += `
                <div class="summary-total" style="margin-top: 15px;">
                    <h3>üí∞ TOTAL ATUAL</h3>
                    <div class="valor">${formatarMoeda(totalAtual)}</div>
                    <p style="margin-top: 10px; opacity: 0.9;">
                        ${regime === 'simples' ? 'DAS Simples Nacional' : 'Sistema tribut√°rio vigente'}
                    </p>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function exibirDiferenca(diferenca) {
            const card = document.getElementById('diferencaCard');
            const valor = document.getElementById('diferencaValor');
            const texto = document.getElementById('diferencaTexto');
            
            if (diferenca > 0) {
                card.className = 'diferenca-card diferenca-negativa';
                valor.textContent = `+ ${formatarMoeda(diferenca)}`;
                texto.textContent = 'Acr√©scimo na carga tribut√°ria com a reforma';
            } else if (diferenca < 0) {
                card.className = 'diferenca-card diferenca-positiva';
                valor.textContent = `- ${formatarMoeda(Math.abs(diferenca))}`;
                texto.textContent = 'Economia na carga tribut√°ria com a reforma';
            } else {
                card.className = 'diferenca-card';
                valor.textContent = formatarMoeda(0);
                texto.textContent = 'Carga tribut√°ria equivalente';
            }
            
            // Calcular percentual
            const percentual = totalAtual > 0 ? (diferenca / totalAtual * 100).toFixed(1) : 0;
            texto.textContent += ` (${Math.abs(percentual)}%)`;
        }

        function proximaEtapa() {
            if (etapaAtual < totalEtapas) {
                // Marcar etapa atual como completa
                document.getElementById(`step${etapaAtual}`).className = 'step completed';
                
                // Ocultar se√ß√£o atual
                document.getElementById(`secao${etapaAtual}`).classList.remove('active');
                
                // Avan√ßar para pr√≥xima etapa
                etapaAtual++;
                
                // Mostrar nova se√ß√£o
                document.getElementById(`secao${etapaAtual}`).classList.add('active');
                document.getElementById(`step${etapaAtual}`).className = 'step active';
                
                // Atualizar progresso
                const progress = (etapaAtual / totalEtapas) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                
                // Atualizar bot√µes
                document.getElementById('btnAnterior').disabled = false;
                if (etapaAtual === totalEtapas) {
                    document.getElementById('btnProximo').textContent = '‚úÖ Finalizar';
                    document.getElementById('btnProximo').onclick = finalizarApuracao;
                    calcularTodosImpostos();
                    calcularReforma();
                }

                if (etapaAtual === 2 || etapaAtual === 3) {
                    calcularAutomatico();
                } else if (etapaAtual === 4) {
                    calcularTodosImpostos();
                } else if (etapaAtual === 5) {
                    calcularTodosImpostos();
                    calcularReforma();
                }
            }
        }

        function voltarEtapa() {
            if (etapaAtual > 1) {
                // Marcar etapa atual como pendente
                document.getElementById(`step${etapaAtual}`).className = 'step pending';
                
                // Ocultar se√ß√£o atual
                document.getElementById(`secao${etapaAtual}`).classList.remove('active');
                
                // Voltar para etapa anterior
                etapaAtual--;
                
                // Mostrar se√ß√£o anterior
                document.getElementById(`secao${etapaAtual}`).classList.add('active');
                document.getElementById(`step${etapaAtual}`).className = 'step active';
                
                // Atualizar progresso
                const progress = (etapaAtual / totalEtapas) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                
                // Atualizar bot√µes
                if (etapaAtual === 1) {
                    document.getElementById('btnAnterior').disabled = true;
                }
                
                document.getElementById('btnProximo').textContent = 'Pr√≥ximo ‚û°Ô∏è';
                document.getElementById('btnProximo').onclick = proximaEtapa;
            }
        }

        function finalizarApuracao() {
            const regime = document.getElementById('regime').value;
            let mensagem = 'üéâ An√°lise completa finalizada!\n\n';
            
            if (regime === 'simples') {
                mensagem += `üìã DAS Simples Nacional: ${formatarMoeda(totalAtual)}\n`;
                mensagem += 'üîÑ Compare com a reforma tribut√°ria\n\n';
                mensagem += 'üí° Simples Nacional: Sistema unificado mantido com poss√≠veis melhorias.';
            } else {
                mensagem += `üìä Sistema Atual: ${formatarMoeda(totalAtual)}\n`;
                mensagem += 'üîÑ Com Reforma: Veja os resultados no comparativo\n\n';
                mensagem += 'üí° Use essas informa√ß√µes para planejamento tribut√°rio estrat√©gico.';
            }
            
            alert(mensagem);
        }

        function limparTudo() {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja limpar todos os dados?')) {
                document.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
                document.getElementById('tipoPeriodo').value = 'mensal';
                document.getElementById('regime').value = 'lucro_real';
                document.getElementById('atividade').value = 'comercio';
                
                etapaAtual = 1;
                
                // Reset das se√ß√µes
                document.querySelectorAll('.section').forEach(secao => secao.classList.remove('active'));
                document.getElementById('secao1').classList.add('active');
                
                // Reset dos steps
                document.querySelectorAll('.step').forEach(step => step.className = 'step pending');
                document.getElementById('step1').className = 'step active';
                
                // Reset do progresso
                document.getElementById('progressFill').style.width = '20%';
                
                // Reset dos bot√µes
                document.getElementById('btnAnterior').disabled = true;
                document.getElementById('btnProximo').textContent = 'Pr√≥ximo ‚û°Ô∏è';
                document.getElementById('btnProximo').onclick = proximaEtapa;
                
                atualizarPeriodo();
                atualizarRegime();
                calcularAutomatico();
            }
        }

        function gerarRelatorio() {
            const regime = document.getElementById('regime').value;
            const diferenca = document.getElementById('diferencaValor').textContent;
            
            let relatorio = 'üìä Relat√≥rio Comparativo Completo\n\n';
            
            if (regime === 'simples') {
                relatorio += `‚úÖ DAS Simples Nacional: ${formatarMoeda(totalAtual)}\n`;
                relatorio += '‚úÖ Simula√ß√£o regime simplificado da reforma\n';
            } else {
                relatorio += `‚úÖ Apura√ß√£o sistema atual: ${formatarMoeda(totalAtual)}\n`;
                relatorio += '‚úÖ Simula√ß√£o reforma tribut√°ria completa\n';
            }
            
            relatorio += `‚úÖ An√°lise de impacto: ${diferenca}\n`;
            relatorio += '‚úÖ Cronograma de transi√ß√£o detalhado\n';
            relatorio += '‚úÖ Recomenda√ß√µes estrat√©gicas\n\n';
            relatorio += 'üíæ Funcionalidade completa ser√° implementada na vers√£o final.';
            
            alert(relatorio);
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            atualizarPeriodo();
            atualizarRegime();
            calcularAutomatico();
        });
    </script>
</body>
</html>
